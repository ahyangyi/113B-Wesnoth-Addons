#textdomain wesnoth-Eight_Kingdoms_Era

#define WEAPON_SPECIAL_EKE_INTIMIDATE2
    [damage]
        id=EKE intimidate 2
        name= _ "intimidate"
        name_inactive= _ "intimidate"
        description= _ "Intimidate: enemy's damage -2 whenever you hit with this attack."
        description_inactive= _ "Intimidate: enemy's damage -2 whenever you hit with this attack."
    [/damage]
#enddef

#ifndef EKE_INTIMIDATE2_EVENTS
#define EKE_INTIMIDATE2_EVENTS
    [event]
        name=attacker_hits
        first_time_only=no

        [filter_attack]
		special=EKE intimidate 2
        [/filter_attack]

        [store_unit]
            variable=temp_varintimidate2unit
            [filter]
                x=$x2
                y=$y2
            [/filter]
        [/store_unit]
        {FOREACH temp_varintimidate2unit.attack eke_intimidate2_tmp}
	        [set_variable]
        	    name=temp_varintimidate2unit.attack[$eke_intimidate2_tmp].damage
           	 add=-2
        	[/set_variable]
	{NEXT eke_intimidate2_tmp}
        [unstore_unit]
            variable=temp_varintimidate2unit
        [/unstore_unit]

        [event]
            name=attack_end

            [store_unit]
                variable=temp_varintimidate2unit
                [filter]
                    x=$x2
                    y=$y2
                [/filter]
            [/store_unit]
        {FOREACH temp_varintimidate2unit.attack eke_intimidate2_tmp}
	        [set_variable]
        	    name=temp_varintimidate2unit.attack[$eke_intimidate2_tmp].damage
           	 add=2
        	[/set_variable]
	{NEXT eke_intimidate2_tmp}
            [unstore_unit]
                variable=temp_varintimidate2unit
            [/unstore_unit]
        [/event]
        {CLEAR_VARIABLE temp_varintimidate2unit}
    [/event]

    [event]
        name=defender_hits
        first_time_only=no

        [filter_second_attack]
		special=EKE intimidate 2
        [/filter_second_attack]

        [store_unit]
            variable=temp_varintimidate2unit
            [filter]
                x=$x1
                y=$y1
            [/filter]
        [/store_unit]
        {FOREACH temp_varintimidate2unit.attack eke_intimidate2_tmp}
	        [set_variable]
        	    name=temp_varintimidate2unit.attack[$eke_intimidate2_tmp].damage
           	 add=-2
        	[/set_variable]
	{NEXT eke_intimidate2_tmp}
        [unstore_unit]
            variable=temp_varintimidate2unit
        [/unstore_unit]

        [event]
            name=attack_end

            [store_unit]
                variable=temp_varintimidate2unit
                [filter]
                    x=$x1
                    y=$y1
                [/filter]
            [/store_unit]
        {FOREACH temp_varintimidate2unit.attack eke_intimidate2_tmp}
	        [set_variable]
        	    name=temp_varintimidate2unit.attack[$eke_intimidate2_tmp].damage
           	 add=2
        	[/set_variable]
	{NEXT eke_intimidate2_tmp}
            [unstore_unit]
                variable=temp_varintimidate2unit
            [/unstore_unit]
        [/event]
        {CLEAR_VARIABLE temp_varintimidate2unit}
    [/event]
#enddef
#endif

